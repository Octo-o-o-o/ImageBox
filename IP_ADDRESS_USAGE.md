# IP地址刷新功能使用说明

## 功能位置

设置页面 → 远程访问 → 外部访问地址

## 使用方法

### 1. 查看当前IP地址

打开设置页面，在"远程访问"部分开启远程访问后，会显示：

```
远程访问已开启，外部访问地址：http://192.168.1.100:3333 🔄
```

其中 `🔄` 是刷新按钮。

### 2. 刷新IP地址

**什么时候需要刷新？**
- ✅ 切换网络连接（从Wi-Fi切换到以太网，或反之）
- ✅ 更换Wi-Fi网络
- ✅ DHCP重新分配了IP地址
- ✅ 显示的IP地址不正确或无法访问

**如何刷新？**
1. 点击外部访问地址旁边的刷新图标（🔄）
2. 等待图标旋转完成（约1秒）
3. 查看更新后的IP地址

### 3. 验证新IP地址

刷新后，您可以：
1. 检查授权码详情中的"快捷登录链接"是否已更新
2. 在其他设备上使用新的IP地址访问应用

## 自动IP选择逻辑

系统会自动选择最合适的IP地址：

### 优先级（从高到低）

1. **物理网络接口** (优先级最高)
   - macOS: en0 (Wi-Fi), en1 (以太网)
   - Windows: Ethernet, Wi-Fi
   - Linux: eth0, wlan0

2. **私有IP地址范围**
   - 192.168.x.x (家庭/办公网络，最优先)
   - 10.x.x.x
   - 172.16-31.x.x

3. **连接类型**
   - 以太网 > Wi-Fi

### 自动过滤的地址

系统会自动跳过以下类型的网络接口：
- ❌ Docker虚拟网络 (docker0, br-xxx)
- ❌ VirtualBox虚拟网络 (vboxnet)
- ❌ VMware虚拟网络 (vmnet)
- ❌ 本地环回地址 (127.0.0.1)
- ❌ 链路本地地址 (169.254.x.x)

## 示例场景

### 场景1：从Wi-Fi切换到以太网

**操作前：**
```
IP: 192.168.1.100 (Wi-Fi)
外部访问地址: http://192.168.1.100:3333
```

**切换网络后：**
```
新网络: 以太网
新IP: 192.168.1.105
```

**操作：**
1. 点击刷新按钮 🔄
2. 系统自动检测到以太网IP: 192.168.1.105
3. 外部访问地址更新为: http://192.168.1.105:3333

### 场景2：更换Wi-Fi网络

**操作前：**
```
网络: 家庭Wi-Fi
IP: 192.168.1.100
```

**更换网络后：**
```
网络: 办公室Wi-Fi
新IP: 10.0.0.50
```

**操作：**
1. 点击刷新按钮 🔄
2. 系统自动检测到新IP: 10.0.0.50
3. 外部访问地址和快捷登录链接全部更新

### 场景3：检测到错误的IP地址

**问题：**
```
显示的IP: 172.20.10.2 (虚拟网络接口)
实际局域网IP: 192.168.1.100
```

**解决：**
1. 点击刷新按钮 🔄
2. 改进后的算法自动选择正确的物理网络接口
3. IP地址更新为: 192.168.1.100

## 常见问题

### Q: 刷新后IP地址没有变化？

**A:** 可能原因：
- 网络配置确实没有改变
- DHCP分配的IP地址相同
- 这是正常情况，说明IP地址仍然有效

### Q: 刷新后显示 localhost？

**A:** 可能原因：
- 没有连接到任何网络
- 只有本地环回接口可用
- 解决：检查网络连接，连接到Wi-Fi或插入网线

### Q: 为什么有时显示的IP不是我想要的？

**A:** 系统会自动选择优先级最高的IP地址。如果您有特殊需求：
- 优先使用以太网而不是Wi-Fi：插入网线即可
- 切换到不同的网络：点击刷新按钮更新
- 如需手动指定IP，这是未来的计划功能

### Q: 多语言支持吗？

**A:** 是的！刷新按钮的提示文本支持13种语言：
- 简体中文："刷新IP地址"
- 繁体中文："刷新IP地址"
- English: "Refresh IP address"
- 日本語: "IPアドレスを更新"
- Deutsch: "IP-Adresse aktualisieren"
- Français: "Actualiser l'adresse IP"
- Русский: "Обновить IP-адрес"
- Português: "Atualizar endereço IP"
- Español: "Actualizar dirección IP"
- Italiano: "Aggiorna indirizzo IP"
- العربية: "تحديث عنوان IP"
- Norsk: "Oppdater IP-adresse"
- Svenska: "Uppdatera IP-adress"

## 技术细节

### 响应时间

- 刷新操作：< 1秒
- 无需重启应用
- 实时更新UI

### 兼容性

- ✅ macOS (Intel & Apple Silicon)
- ✅ Windows (x64)
- ✅ Linux (x64 & ARM64)
- ✅ Docker容器环境

### 安全性

- ✅ 只在本地获取IP地址
- ✅ 不涉及外部API调用
- ✅ 不收集或上传任何数据

## 相关功能

- [授权码管理](./app/settings/page.tsx) - 创建和管理远程访问授权码
- [远程访问设置](./app/settings/page.tsx) - 开启/关闭远程访问
- [快捷登录链接](./app/settings/page.tsx) - 一键复制登录链接

## 反馈和建议

如果您遇到问题或有改进建议，请：
1. 查看 [IP_ADDRESS_FIX.md](./IP_ADDRESS_FIX.md) 了解技术细节
2. 提交 GitHub Issue
3. 检查日志文件（桌面应用）
